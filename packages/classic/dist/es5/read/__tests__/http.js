'use strict';var R=_interopRequireWildcard(require("ramda"));var http=_interopRequireWildcard(require("../http"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}}newObj.default=obj;return newObj;}}describe('http',function(){describe('a response',function(){test('is a response if it has a value',function(){expect(http.isResponse(null)).not.toBeTruthy();expect(http.isResponse('')).not.toBeTruthy();expect(http.isResponse([])).not.toBeTruthy();expect(http.isResponse({A:1})).not.toBeTruthy();expect(http.isResponse({value:1})).toBeTruthy();expect(http.isResponse({value:2,meta:{status:500}})).toBeTruthy();});test('is a response if it has a status code',function(){expect(http.isResponse({meta:{}})).not.toBeTruthy();expect(http.isResponse({meta:{status:300}})).toBeTruthy();});test('is ok if it has a value, and no meta',function(){expect(http.isOK({value:1})).toBeTruthy();expect(http.isOK({meta:{}})).not.toBeTruthy();});test('is ok if it has a status of 2xx **and** it has a value',function(){expect(http.isOK({value:1,meta:{status:222}})).toBeTruthy();expect(http.isOK({value:1,meta:{status:300}})).not.toBeTruthy();expect(http.isOK({value:1,meta:{status:200}})).toBeTruthy();expect(http.isOK({meta:{status:200}})).not.toBeTruthy();});test('obtaining a response from a value',function(){expect(http.asResponse(1)).toEqual({value:1});expect(http.asResponse(1,'http://example.com')).toEqual({value:1,meta:{status:200,message:'OK',uri:'http://example.com',url:'http://example.com'}});});expect(http.failedResponse('Fail')).toEqual({meta:{status:999,message:'Fail'}});expect(http.failedResponse('Fail','http://example.com')).toEqual({meta:{status:999,message:'Fail',uri:'http://example.com',url:'http://example.com'}});expect(http.failedResponse('Fail',42,'http://example.com')).toEqual({value:42,meta:{status:999,message:'Fail',uri:'http://example.com',url:'http://example.com'}});});describe('flow',function(){test('chains transformation fns on the value of a OK responise',function(){var resp=http.asResponse(10);expect(http.flow(resp,R.inc,R.add(10))).toEqual({value:21});expect(http.flow(http.failedResponse('Fail'),R.inc,R.add(10))).toEqual({meta:{status:999,message:'Fail'}});});test('a transform fn can return a response',function(){var resp=http.asResponse(10);expect(http.flow(resp,R.inc,function(){return http.asResponse('something');},R.length)).toEqual({value:9});expect(http.flow(resp,R.inc,function(){return http.failedResponse('Fail');},R.dec)).toEqual({meta:{status:999,message:'Fail'}});});});describe('HTTP methods',function(){beforeEach(function(){fetch.resetMocks();fetch.mockResponseOnce(JSON.stringify({data:'12345'}));});describe('execute/get',function(){test('just an uri',function _callee(){return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return regeneratorRuntime.awrap(http.execute('http://example.com'));case 2:expect(fetch).toHaveBeenCalledWith('http://example.com',expect.objectContaining({method:'GET'}));case 3:case"end":return _context.stop();}}},null,this);});test('specifying a method',function _callee2(){return regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return regeneratorRuntime.awrap(http.execute('http://example.com',{method:'HEAD'}));case 2:expect(fetch).toHaveBeenCalledWith('http://example.com',expect.objectContaining({method:'HEAD'}));case 3:case"end":return _context2.stop();}}},null,this);});test('extra headers',function _callee3(){return regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return regeneratorRuntime.awrap(http.execute('http://example.com',{headers:{'Cache-Control':'max-age=200'}}));case 2:expect(fetch).toHaveBeenCalledWith('http://example.com',expect.objectContaining({method:'GET'}));expect(fetch.mock.calls[0][1].headers.get('Cache-Control')).toEqual('max-age=200');case 4:case"end":return _context3.stop();}}},null,this);});test('revalidate option',function _callee4(){var headers;return regeneratorRuntime.async(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return regeneratorRuntime.awrap(http.execute('http://example.com',{revalidate:true,headers:{Agent:'x'}}));case 2:expect(fetch).toHaveBeenCalledWith('http://example.com',expect.objectContaining({method:'GET'}));headers=fetch.mock.calls[0][1].headers;expect(headers.get('Cache-Control')).toEqual('max-age=0');expect(headers.get('Agent')).toEqual('x');case 6:case"end":return _context4.stop();}}},null,this);});test('OK response',function _callee5(){var response;return regeneratorRuntime.async(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return regeneratorRuntime.awrap(http.execute('http://example.com'));case 2:response=_context5.sent;expect(http.isResponse(response)).toBeTruthy();expect(http.isOK(response)).toBeTruthy();expect(response.value.toJS()).toEqual({data:'12345'});case 6:case"end":return _context5.stop();}}},null,this);});test('Failed response',function _callee6(){var response;return regeneratorRuntime.async(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:fetch.resetMocks();fetch.mockResponseOnce(JSON.stringify({}),{status:404});_context6.next=4;return regeneratorRuntime.awrap(http.execute('http://example.com'));case 4:response=_context6.sent;expect(http.isResponse(response)).toBeTruthy();expect(http.isOK(response)).not.toBeTruthy();expect(response.meta).toMatchObject({status:404,message:'Not Found'});case 8:case"end":return _context6.stop();}}},null,this);});});describe('post/put/patch',function(){test('post',function _callee7(){var _arr,_i,m,headers;return regeneratorRuntime.async(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_arr=['post','put','patch'];_i=0;case 2:if(!(_i<_arr.length)){_context7.next=14;break;}m=_arr[_i];fetch.resetMocks();fetch.mockResponseOnce(JSON.stringify({data:'12345'}));_context7.next=8;return regeneratorRuntime.awrap(http[m].call(http,'http://example.com',{test:1},{headers:{Agent:'x'},foo:'bar'}));case 8:expect(fetch).toHaveBeenCalledWith('http://example.com',expect.objectContaining({method:m.toUpperCase(),foo:'bar',body:JSON.stringify({test:1})}));headers=fetch.mock.calls[0][1].headers;expect(headers.get('Agent')).toEqual('x');case 11:_i++;_context7.next=2;break;case 14:case"end":return _context7.stop();}}},null,this);});});describe('options/head/del',function _callee8(){var _arr2,_i2,m,headers;return regeneratorRuntime.async(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_arr2=['options','head','del'];_i2=0;case 2:if(!(_i2<_arr2.length)){_context8.next=14;break;}m=_arr2[_i2];fetch.resetMocks();fetch.mockResponseOnce(JSON.stringify({data:'12345'}));_context8.next=8;return regeneratorRuntime.awrap(http[m].call(http,'http://example.com',{headers:{Agent:'x'},foo:'bar'}));case 8:expect(fetch).toHaveBeenCalledWith('http://example.com',expect.objectContaining({method:m==='del'?'DELETE':m.toUpperCase(),foo:'bar'}));headers=fetch.mock.calls[0][1].headers;expect(headers.get('Agent')).toEqual('x');case 11:_i2++;_context8.next=2;break;case 14:case"end":return _context8.stop();}}},null,this);});test('faild http call returns 998 as status code',function _callee9(){var response;return regeneratorRuntime.async(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:fetch.resetMocks();fetch.mockReject();_context9.next=4;return regeneratorRuntime.awrap(http.get('http://example.com'));case 4:response=_context9.sent;expect(response.meta.status).toEqual(998);case 6:case"end":return _context9.stop();}}},null,this);});});});
'use strict';var _enzyme=require("enzyme");var _react=_interopRequireDefault(require("react"));var propNames=_interopRequireWildcard(require("../../propNames"));var Subsystem=_interopRequireWildcard(require("../../subsystem"));var Kernel=_interopRequireWildcard(require("../../kernel"));var _engine=require("../../engine");var _=_interopRequireDefault(require(".."));var _update=_interopRequireDefault(require("../../update"));var _jsxFileName="/Users/lukaskurucz/Git/skele/packages/classic/src/ui/__tests__/shouldComponentUpdate.js";function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var app=Subsystem.create(function(){return{name:'app'};});var ui=app.ui;var update=app.update;describe('Should component update of element UI',function(){var _data;var data=(_data={kind:'container'},_defineProperty(_data,propNames.children,'items'),_defineProperty(_data,"name",'A Name'),_defineProperty(_data,"items",[{kind:'item',data:'a'},{kind:'item',data:'b'}]),_data);var renderItem=jest.fn();renderItem.mockImplementation(function(_ref){var element=_ref.element;return _react.default.createElement("div",{__source:{fileName:_jsxFileName,lineNumber:43}},"Element ",element.get('data'));});var renderContainer=jest.fn();renderContainer.mockImplementation(function(_ref2){var element=_ref2.element,uiFor=_ref2.uiFor;return _react.default.createElement("ul",{__source:{fileName:_jsxFileName,lineNumber:48}},_react.default.createElement("li",{__source:{fileName:_jsxFileName,lineNumber:49}},"Name: ",element.get('name')),_react.default.createElement("li",{__source:{fileName:_jsxFileName,lineNumber:50}},uiFor(['items',0])),_react.default.createElement("li",{__source:{fileName:_jsxFileName,lineNumber:51}},uiFor(['items',1])));});afterEach(function(){renderItem.mockClear();renderContainer.mockClear();});ui.register('container',renderContainer);ui.register('item',renderItem);update.register('container','rename',function(c,_ref3){var name=_ref3.name;return c.set('name',name);});update.register('item','data',function(i,_ref4){var data=_ref4.data;return i.set('data',data);});test('when a child changes, all its ancestor rerender',function(){var kernel=Kernel.create([_update.default,_.default,app],data,{});(0,_enzyme.mount)(_react.default.createElement(_engine.EntryPoint,{kernel:kernel,keyPath:[],__source:{fileName:_jsxFileName,lineNumber:69}}));expect(renderContainer).toHaveBeenCalledTimes(1);expect(renderItem).toHaveBeenCalledTimes(2);renderContainer.mockClear();renderItem.mockClear();kernel.focusOn(['items',0]).dispatch({type:'data',data:'X'});expect(renderContainer).toHaveBeenCalledTimes(1);expect(renderItem).toHaveBeenCalledTimes(1);});test('when ancestor changes, children will not rerender',function(){var kernel=Kernel.create([_update.default,_.default,app],data,{});(0,_enzyme.mount)(_react.default.createElement(_engine.EntryPoint,{kernel:kernel,keyPath:[],__source:{fileName:_jsxFileName,lineNumber:86}}));expect(renderContainer).toHaveBeenCalledTimes(1);expect(renderItem).toHaveBeenCalledTimes(2);renderContainer.mockClear();renderItem.mockClear();kernel.focusOn([]).dispatch({type:'rename',name:'New Name'});expect(renderContainer).toHaveBeenCalledTimes(1);expect(renderItem).not.toHaveBeenCalled();});test('when by-value data remains the same, nothing rerenders',function(){var kernel=Kernel.create([_update.default,_.default,app],data,{});(0,_enzyme.mount)(_react.default.createElement(_engine.EntryPoint,{kernel:kernel,keyPath:[],__source:{fileName:_jsxFileName,lineNumber:103}}));expect(renderContainer).toHaveBeenCalledTimes(1);expect(renderItem).toHaveBeenCalledTimes(2);renderContainer.mockClear();renderItem.mockClear();kernel.focusOn([]).dispatch({type:'rename',name:'A Name'});expect(renderContainer).not.toHaveBeenCalled();expect(renderItem).not.toHaveBeenCalled();});});